<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
	  template="/public/template_initial.xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
 
	<!-- TOP BAR DEFINE -->
	<ui:define name="top_bar">
		<ui:include src="/public/top_bar-admin.xhtml"/>
	</ui:define>
  
  	<!-- NAV BAR DEFINE -->
	<ui:define name="nav_bar">
		<ui:include src="/public/nav_bar-admin.xhtml"/>
	</ui:define>	

	<!-- CONTENT DEFINE -->
	<ui:define name="page_content">	

		<div id="content">
            <div class="container">	
            
            	<h:form
            		id="frm-escolha">
            		
            		<div class="row">
						<div class="col-md-12">
		                
		                    <ul class="breadcrumb">
		                        <li><a href="#">Home</a>
		
		                        <li>
		                        	<a href="./pesquisa-escolha.xhtml">Escolha</a>
		                        </li>
		                        
		                        </li>
		                        <li>Separação de itens</li>
		                    </ul>
		                    
		                </div>
		            </div> <!-- fim row menu -->

	                <div class="row">
		                <h:panelGroup
		                	id="panel-alerta"
		                	rendered="#{not atendeEscolhaBean.podeAtender}">
		                
							<div class="col-md-9" id="box-mensagem">
								
								<h:messages 
					    	  		id="messages"
							      	errorClass="alert alert-block alert-danger fade in"
							      	infoClass="alert alert-block alert-success fade in"
						     	 	style="padding-left:0px"
						     	 	globalOnly="true"/>
							    
							    <div class="box">
							        <p>Não é possível atender esta escolha.</p>
							    </div>
							</div>	         
		                </h:panelGroup>	
		            </div> <!-- fim row alerta -->
		            
		            <div class="row">       
	                
		                <h:panelGroup
		                	id="panel-escolha"
		                	rendered="#{atendeEscolhaBean.podeAtender}">
		
			                <div class="col-md-12">
			                
			                    <div class="box" id="box-escolha">
			        	
			        				<h3>Informações da Escolha</h3>
			        				
			        				<div class="row">
							
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-cod">Código</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-cod" 
					                            	value="#{atendeEscolhaBean.escolha.codigoFormatado()}"
					                            	readonly="true"/>				                            	
						                 	</div>
						            	</div>
						
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-codigo-cliente">Código do cliente</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-codigo-cliente" 
					                            	value="#{atendeEscolhaBean.escolha.cliente.codigoSiga}"
					                            	readonly="true"/>				                            	
						                 	</div>
						            	</div>
						
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-nome">Nome do cliente</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-nome" 
					                            	value="#{atendeEscolhaBean.escolha.cliente.nome}"
					                            	readonly="true"/>				                            	
						                 	</div>
						            	</div>
						
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-regiao">Região do cliente</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-regiao" 
					                            	value="#{atendeEscolhaBean.escolha.cliente.regiao.descricao}"
					                            	readonly="true"/>				                            	
						                 	</div>
						            	</div>
						
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-data">Data</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-data" 
					                            	value="#{atendeEscolhaBean.escolha.data}"
					                            	readonly="true">
					                            	
					                            	<f:converter
					                            		converterId="localDateTimeFacesConverter"/>
					                            </h:inputText>				                            	
						                 	</div>
						            	</div>
						            
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-qtd-itens">Qtd de itens</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-qtd-intes" 
					                            	value="#{atendeEscolhaBean.escolha.qtdDeItens()}"
					                            	readonly="true">
					                            	
					                            	<f:convertNumber
					                            		type="number"
					                            		locale="pt_BR"/>
					                            </h:inputText>				                            	
						                 	</div>
						            	</div>
						            
										<div class="col-sm-6"> 
											<div class="form-group">
						                        
					                            <label for="input-qtd-intes-nao-descontaveis">Material de apoio</label>
					                            <h:inputText 
					                            	class="form-control" 
					                            	id="input-qtd-intes-nao-descontaveis" 
					                            	value="#{atendeEscolhaBean.escolha.qtdDeItensNaoDescontaveis()}"
					                            	readonly="true">
					                            	
					                            	<f:convertNumber
					                            		type="number"
					                            		locale="pt_BR"/>
					                            </h:inputText>				                            	
						                 	</div>
						            	</div>					            
							        </div>
							        
							        <div class="row">
							        
							        	<h:panelGroup id="panel-btn-atende" style="text-align:right">    
				                        	<div class="col-md-12">                        
						                        <h:commandButton
						                        	class="btn btn-primary"
						                        	action="#{atendeEscolhaBean.finalizaEscolha()}"
						                        	value="Finalizar"
						                        	disabled="#{not atendeEscolhaBean.podeAtender}"
						                        	rendered="#{atendeEscolhaBean.escolha.foramTodosOsItensAtendidos()}">
						                        	
						                        	<f:ajax
						                        		execute="@this"
						                        		render="frm-escolha"/>
					                        	</h:commandButton>
	
							                    <h:commandButton
						                        	class="btn btn-warning"
						                        	style="margin-right:5px"
													value="Atender parcialmente"
						                        	disabled="#{not atendeEscolhaBean.podeAtender}"
						                        	rendered="#{not atendeEscolhaBean.escolha.foramTodosOsItensAtendidos()}"
						                        	action="${atendeEscolhaBean.atendeParcialmente()}">
						                        	
						                        	<f:ajax
						                        		execute="@this"
						                        		render="frm-escolha"/>
					                        	</h:commandButton>
	
												<a class="btn btn-danger" 
													jsfc="h:commandLink"
													type="button"
													immediate="true"
													value="Finalizar parcialmente"
						                        	disabled="#{not atendeEscolhaBean.podeAtender}"
						                        	rendered="#{not atendeEscolhaBean.escolha.foramTodosOsItensAtendidos()}">
								                  
								                   <f:passThroughAttribute name="data-toggle" value="modal" />
								                   <f:passThroughAttribute name="data-target" value="#myModalAtendimento" />
								                   <f:ajax/>
												</a>
					                        	
				                        	</div>
				                        	
				                        </h:panelGroup>				            				            		            
									</div>											
									
								</div>
								<!-- /.box-escolha -->
							</div>
						
					        <div class="col-md-12" id="table">
					
					            <div class="box">
					
				                    <h3>Itens do escolha</h3>
				                    
				                    <h:panelGroup
				                    	id="panel-itens">
				                    
					                    <div class="table-responsive">
					                        <table class="table table-striped table-advance table-hover">
					                            <thead>
					                                <tr>
					                                	<th style="width:15px">
					                                	
													   		<a jsfc="h:commandLink"
													   			action="#{atendeEscolhaBean.atendeTodos()}"
													   			disabled="#{not atendeEscolhaBean.podeAtender}"
													   			
													   			class="btn btn-warning">
													   			
													        	<f:ajax
									                        		execute="@this"
									                        		render="frm-escolha:panel-itens panel-btn-atende"/>
																
																<i class="icon_close_alt2"></i>							                        		
													   		</a>
					                                	
					                                	</th>
					                                	<th style="width:30px">Qtd</th>
					                                    <th>Código</th>
					                                    <th style="width:600px; overflow: hidden">Descrição</th>
					                                    <th style="width:300px">Grade</th>
					                                    <th style="width:80px">Localização</th>
					                                </tr>
					                            </thead>
					                            
					                            <tbody>
					                            
													<ui:repeat 
														var="item" 
													   	value="#{atendeEscolhaBean.escolha.itens}">		                          
														<tr>
															<td>	               
														   		<a jsfc="h:commandLink"
														   			action="#{atendeEscolhaBean.separaItem()}"
														   			disabled="#{not atendeEscolhaBean.podeAtender}"
														   			class="#{item.atendido ? 'btn btn-warning' : 'btn btn-primary'}">
														   			
														   			<f:setPropertyActionListener 
														   				target="#{atendeEscolhaBean.itemSelecionado}"
														   				value="#{item}"/> 
														   			
														        	<f:ajax
										                        		execute="@this"
										                        		render="frm-escolha:panel-itens frm-escolha:panel-btn-atende"/>
										                        	
										                        	<i class="#{item.atendido ? 'icon_close_alt2' : 'icon_check_alt2'}"></i>
														   		</a>
														   	</td>
														   	
														   	<td>
														   		<h:outputText 
														   			value="#{item.qtd}">
														   			
														   			<f:convertNumber 
														   				type="number"/>
														   		</h:outputText>
														   	</td>												   	
					                                    	
															<td>#{item.produto.codigoInterno}</td>
															<td>#{item.produto.descricao}</td>
														   	<td>#{item.grade}</td>										   
														   	<td>#{item.grade.localizacao}</td>
														</tr>
													</ui:repeat>		                            
				
				                                   </tbody>
				                               </table>
				
				                       	</div>
				                        <!-- /.table-responsive -->
				                
				                	</h:panelGroup> <!-- /.panel-itens -->
				                	
			                  	</div> 
			                  	<!-- /#box -->
			                  	
			            	</div>
			            	<!-- /.cod-md-12 -->
			            </h:panelGroup>
			            <!-- /.panel-escolha -->
			    	</div> <!-- fim row dados -->

	           		<!-- Modal -->
					<div class="modal fade" id="myModalAtendimento" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
					  <div class="modal-dialog" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
			      	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					        <h5 class="modal-title" id="myModalLabel">
					        	<strong>Deseja atender e finalizar a escolha?</strong></h5>
					      </div>
					      <div class="modal-body">
					      	<div class="row">
								<div class="col-md-2">
									<p align="center"><span style="font-size:32px">?</span></p>
								</div>
								<div class="col-md-10">
									<p>Nem todos os itens da escolha foram atendidos. <strong>Deseja realmente anteder parcialmente e finalizar?</strong></p>
								</div>
							</div>
							<div>
		                		<div 
               						style="text-align:right"
               						id="btns-confirm">
			                	
			                		<a  type="submit"
			                			class="btn btn-warning btn-sm"
			                			jsfc="h:commandLink"
			                			action="#{atendeEscolhaBean.finalizaEscolha()}">
			                			Sim
									
										<f:passThroughAttribute name="data-dismiss" value="modal" />
										<f:ajax
					               			execute="@this"
					               			render="@all"
					               			onevent="eventSpinnerHandler"/>
									</a>
		                		
		                			<button 
		                				id="close"
		                				type="submit" 
		                				class="btn btn-info btn-sm">Não</button>
		                		</div>
		                		<!-- /.btns-confirm -->								
							</div>
					      </div>			      
					    </div>
					  </div>
					</div> 
					
					<!-- Modal Spinner -->
					<div class="modal fade bd-example-modal-sm modal-spinner" id="modal-spinner" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
					  <div class="modal-dialog modal-sm modal-spinner-dialog">
					    <div class="modal-content" >
					      <div class="modal-body" id="modalBody">
							<div class="spinner">
								<p align="center"><i class="fa fa-spinner fa-spin fa-4x"></i></p>
							</div>
					      </div>	    
					    </div>
					  </div>
					</div>	
					<!-- End of Modal Spinner -->					
	            	
	            </h:form> <!--  end /frm-escolha -->
		            	
            </div>
            <!-- /.container -->
        </div>
        <!-- /#content -->		
	
	</ui:define>
	<!-- END OF DEFINE CONTENT -->
	
	<!-- DEFINE FOOTER -->
	<ui:define name="footer">
	   	<ui:include src="/public/footer.xhtml" />
	</ui:define>
	<!-- END OF DEFINE FOOTER -->
	   
	<!-- DEFINE SCRIPT -->
	<ui:define name="script">
		<h:outputScript library="js" name="spinner-handler.js"/>
	</ui:define>
	<!-- END OF DEFINE SCRIPT -->			
			
</ui:composition>
